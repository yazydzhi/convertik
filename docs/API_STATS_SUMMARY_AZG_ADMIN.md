# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `/api/v1/stats/summary` —Å azg_admin

> üìä –ê–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
> –í–µ—Ä—Å–∏—è: 1.0 ¬∑ –û–±–Ω–æ–≤–ª–µ–Ω–æ: 2025-12-10

---

## –ü—Ä–æ–±–ª–µ–º–∞

–¢–µ–∫—É—â–∏–π endpoint `/api/v1/stats/summary` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "total_events": 10000,
  "unique_devices": 500,
  "events_today": 200,
  "top_events": [
    {"event": "app_open", "count": 8000},
    {"event": "conversion", "count": 1500}
  ]
}
```

**–ü—Ä–æ–±–ª–µ–º—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å azg_admin:**

1. ‚ùå **–ù–µ—Ç –æ–±–µ—Ä—Ç–∫–∏ `metrics`** ‚Äî azg_admin –æ–∂–∏–¥–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç `{"metrics": {...}}`
2. ‚ùå **–ú–∞—Å—Å–∏–≤ `top_events`** ‚Äî azg_admin –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∞—Å—Å–∏–≤—ã, –Ω–æ —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
3. ‚ùå **–ù–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫** ‚Äî –ø—Ä–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –Ω–µ–ª—å–∑—è –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã
4. ‚ùå **–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** ‚Äî `total_events` –∏ `unique_devices` –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è, –∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

---

## –ö–∞–∫ azg_admin –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏

### –û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç

azg_admin –æ–∂–∏–¥–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "metrics": {
    "metric_name": numeric_value,
    ...
  }
}
```

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

1. **–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫** (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç):
   ```python
   # azg_admin/backend/app/services/integration_service.py
   response = await client.get(project.metrics_url)
   data = response.json()

   # –ï—Å–ª–∏ –µ—Å—Ç—å "metrics", –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ, –∏–Ω–∞—á–µ –≤–µ—Å—å –æ–±—ä–µ–∫—Ç
   if "metrics" in data:
       metrics = data["metrics"]
   else:
       metrics = data  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ—Å—å –æ–±—ä–µ–∫—Ç
   ```

2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –º–µ—Ç—Ä–∏–∫–∏**:
   ```python
   # azg_admin/backend/app/services/monitoring_service.py
   product_metrics = [
       'total_events', 'unique_devices', 'events_today', 'dau', 'wau', 'mau',
       'revenue', 'conversion', 'app_open', 'currency_added'
   ]
   ```

3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î**:
   - –ö–∞–∂–¥–∞—è –º–µ—Ç—Ä–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å `collected_at` (–≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞)
   - –¢–∏–ø –º–µ—Ç—Ä–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ú–∞—Å—Å–∏–≤—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Å—Å–∏–≤–æ–≤**:
   ```python
   # –ï—Å–ª–∏ top_events = [{"event": "app_open", "count": 8000}]
   # –°–æ–∑–¥–∞—é—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∏:
   # - metric_name: "event_app_open", value: 8000, type: "product"
   ```

---

## –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- `total_events` ‚Äî –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è (–≤—Å–µ —Å–æ–±—ã—Ç–∏—è –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è)
- `unique_devices` ‚Äî –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è (–≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è)
- `events_today` ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å

**–ü—Ä–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç):**
- ‚úÖ `events_today` ‚Äî –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è
- ‚ùå `total_events` ‚Äî –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞—Å—Ç–∏ (–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—Ä–µ–Ω–¥)
- ‚ùå `unique_devices` ‚Äî –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞—Å—Ç–∏ (–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—Ä–µ–Ω–¥)

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ azg_admin:**
- –ì—Ä–∞—Ñ–∏–∫ `total_events` –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞—Å—Ç–∏ –≤–≤–µ—Ä—Ö
- –ì—Ä–∞—Ñ–∏–∫ `unique_devices` –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞—Å—Ç–∏ –≤–≤–µ—Ä—Ö
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Ç—Ä–µ–Ω–¥—ã –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫

**–¢–µ–∫—É—â–∏–π endpoint:**
- –ù–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `timestamp` –∏–ª–∏ `collected_at`
- azg_admin –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–≤–æ—é –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç, –Ω–æ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–∞–∑ –≤ –¥–µ–Ω—å
- –ì—Ä–∞—Ñ–∏–∫ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è 288 —Ä–∞–∑ –≤ –¥–µ–Ω—å (24 —á–∞—Å–∞ √ó 12 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å)

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:**
```json
{
  "total_events": 10000,
  "unique_devices": 500,
  "events_today": 200,
  "top_events": [...]
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç azg_admin:**
```json
{
  "metrics": {
    "total_events": 10000,
    "unique_devices": 500,
    "events_today": 200
  }
}
```

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ azg_admin:**
```python
# integration_service.py:105-109
if "metrics" in data:
    metrics = data["metrics"]
else:
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ—Å—å –æ–±—ä–µ–∫—Ç –∫–∞–∫ –º–µ—Ç—Ä–∏–∫–∏
    metrics = data
```

‚úÖ **–•–æ—Ä–æ—à–∞—è –Ω–æ–≤–æ—Å—Ç—å:** azg_admin –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–µ–∫—É—â–∏–º —Ñ–æ—Ä–º–∞—Ç–æ–º (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–µ—Å—å –æ–±—ä–µ–∫—Ç –∫–∞–∫ –º–µ—Ç—Ä–∏–∫–∏)

---

## –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### –ü—Ä–æ–¥—É–∫—Ç–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (Product Metrics)

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –§–æ—Ä–º—É–ª–∞ |
|---------|----------|---------|
| **DAU** | Daily Active Users | `COUNT(DISTINCT device_id) WHERE date = today` |
| **WAU** | Weekly Active Users | `COUNT(DISTINCT device_id) WHERE date >= today - 7 days` |
| **MAU** | Monthly Active Users | `COUNT(DISTINCT device_id) WHERE date >= today - 30 days` |
| **Stickiness** | –ü—Ä–∏–ª–∏–ø—á–∏–≤–æ—Å—Ç—å | `DAU / MAU` |
| **Retention** | –£–¥–µ—Ä–∂–∞–Ω–∏–µ | `users_active_today AND active_last_week / users_active_last_week` |
| **Churn** | –û—Ç—Ç–æ–∫ | `1 - retention_rate` |
| **Session Duration** | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏ | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É `app_open` –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ–º |
| **Sessions per User** | –°–µ—Å—Å–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `COUNT(sessions) / COUNT(users)` |

### –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –§–æ—Ä–º—É–ª–∞ |
|---------|----------|---------|
| **ARPU** | Average Revenue Per User | `total_revenue / total_users` |
| **ARPPU** | Average Revenue Per Paying User | `total_revenue / paying_users` |
| **Conversion Rate** | –ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –ø–æ–∫—É–ø–∫—É | `paying_users / total_users` |
| **LTV** | Lifetime Value | –ù–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è |
| **MRR** | Monthly Recurring Revenue | –°—É–º–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –∑–∞ –º–µ—Å—è—Ü |
| **Churn Rate** | –û—Ç—Ç–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫ | `cancelled_subscriptions / active_subscriptions` |

### –ú–µ—Ç—Ä–∏–∫–∏ –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –§–æ—Ä–º—É–ª–∞ |
|---------|----------|---------|
| **Events per User** | –°–æ–±—ã—Ç–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `total_events / unique_users` |
| **Active Rate** | –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | `active_users / total_users` |
| **Feature Adoption** | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π | `users_using_feature / total_users` |

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint `/api/v1/metrics`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º azg_admin
- ‚úÖ –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
- ‚úÖ –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥
- ‚úÖ –ù–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `/stats/summary`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
@router.get("/metrics")
async def get_metrics(
    period: str = Query("day", regex="^(day|week|month)$"),
    db: AsyncSession = Depends(get_db)
) -> dict:
    """
    –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è azg_admin

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º —Å azg_admin
    """
    now = datetime.now(timezone.utc)

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–∏–æ–¥
    if period == "day":
        start_date = now.replace(hour=0, minute=0, second=0, microsecond=0)
    elif period == "week":
        start_date = now - timedelta(days=7)
    elif period == "month":
        start_date = now - timedelta(days=30)

    # –í—ã—á–∏—Å–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥
    dau_query = """
        SELECT COUNT(DISTINCT device_id)
        FROM usage_events
        WHERE created_at >= :start_date
    """

    total_events_query = """
        SELECT COUNT(*)
        FROM usage_events
        WHERE created_at >= :start_date
    """

    # –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å—ã
    dau_result = await db.execute(text(dau_query), {"start_date": start_date})
    dau = dau_result.scalar()

    events_result = await db.execute(text(total_events_query), {"start_date": start_date})
    total_events = events_result.scalar()

    # –í—ã—á–∏—Å–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
    events_per_user = total_events / dau if dau > 0 else 0

    return {
        "timestamp": now.isoformat(),
        "metrics": {
            "dau": dau,
            "total_events": total_events,
            "events_per_user": round(events_per_user, 2),
            "events_today": await get_events_today(db),
            # –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ top_events
            **await get_top_events_metrics(db, start_date)
        }
    }
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π endpoint

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –î–æ–±–∞–≤–∏—Ç—å –æ–±–µ—Ä—Ç–∫—É `metrics`:
```python
return {
    "timestamp": datetime.now(timezone.utc).isoformat(),
    "metrics": {
        "total_events": stats["total_events"],
        "unique_devices": stats["unique_devices"],
        "events_today": stats["events_today"],
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º top_events –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
        **{f"event_{event['event']}": event['count']
           for event in stats["top_events"]}
    }
}
```

2. –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–µ—Ä–∏–æ–¥–∞:
```python
@router.get("/stats/summary")
async def get_stats_summary(
    period: str = Query("all", regex="^(all|day|week|month)$"),
    db: AsyncSession = Depends(get_db)
) -> dict:
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –î–æ–±–∞–≤–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ DAU/WAU/MAU

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:**

```python
queries = {
    "dau": """
        SELECT COUNT(DISTINCT device_id)
        FROM usage_events
        WHERE created_at >= (NOW() AT TIME ZONE 'UTC')::date
    """,
    "wau": """
        SELECT COUNT(DISTINCT device_id)
        FROM usage_events
        WHERE created_at >= (NOW() AT TIME ZONE 'UTC')::date - INTERVAL '7 days'
    """,
    "mau": """
        SELECT COUNT(DISTINCT device_id)
        FROM usage_events
        WHERE created_at >= (NOW() AT TIME ZONE 'UTC')::date - INTERVAL '30 days'
    """,
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
}
```

---

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –¥–ª—è azg_admin

```json
{
  "timestamp": "2025-12-10T12:00:00Z",
  "metrics": {
    "dau": 150,
    "wau": 850,
    "mau": 3500,
    "total_events": 10000,
    "events_today": 200,
    "events_per_user": 2.86,
    "event_app_open": 8000,
    "event_conversion": 1500,
    "event_ad_impression": 500,
    "event_currency_added": 200
  }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç—É azg_admin
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥ (–Ω–µ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–µ)
- ‚úÖ –û—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è

---

## –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

–ï—Å–ª–∏ azg_admin –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `/api/v1/stats/summary` –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç:

1. **`total_events`** ‚Äî –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞—Å—Ç–∏
   - –ó–∞–ø—Ä–æ—Å 1: 10000
   - –ó–∞–ø—Ä–æ—Å 2: 10005 (–µ—Å–ª–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è)
   - –ó–∞–ø—Ä–æ—Å 3: 10010
   - –ì—Ä–∞—Ñ–∏–∫: –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞—Å—Ç—É—â–∞—è –ª–∏–Ω–∏—è

2. **`unique_devices`** ‚Äî –±—É–¥–µ—Ç —Ä–∞—Å—Ç–∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ
   - –ó–∞–ø—Ä–æ—Å 1: 500
   - –ó–∞–ø—Ä–æ—Å 2: 501 (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
   - –ó–∞–ø—Ä–æ—Å 3: 501
   - –ì—Ä–∞—Ñ–∏–∫: —Å—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è –ª–∏–Ω–∏—è

3. **`events_today`** ‚Äî –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –ó–∞–ø—Ä–æ—Å 1: 200
   - –ó–∞–ø—Ä–æ—Å 2: 205 (–Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –∑–∞ –¥–µ–Ω—å)
   - –ó–∞–ø—Ä–æ—Å 3: 210
   - –ì—Ä–∞—Ñ–∏–∫: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –¥–µ–Ω—å

### –†–µ—à–µ–Ω–∏–µ

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥ –≤–º–µ—Å—Ç–æ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã—Ö:**

```python
# –í–º–µ—Å—Ç–æ:
"total_events": "SELECT COUNT(*) FROM usage_events"

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
"events_last_24h": """
    SELECT COUNT(*)
    FROM usage_events
    WHERE created_at >= NOW() - INTERVAL '24 hours'
"""
```

---

## –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### App Store Connect / Google Play Console

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| **Installs** | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç–∞–Ω–æ–≤–æ–∫ |
| **Uninstalls** | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–∏–π |
| **Active Users** | –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (DAU/WAU/MAU) |
| **Sessions** | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π |
| **Session Duration** | –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏ |
| **Crashes** | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∞—à–µ–π |
| **ANR** | Application Not Responding (Android) |
| **Revenue** | –í—ã—Ä—É—á–∫–∞ |
| **IAP Purchases** | –ü–æ–∫—É–ø–∫–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ |
| **Subscriptions** | –ü–æ–¥–ø–∏—Å–∫–∏ |

### Firebase Analytics / Google Analytics

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| **Active Users** | –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ |
| **New Users** | –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ |
| **Sessions** | –°–µ—Å—Å–∏–∏ |
| **Screen Views** | –ü—Ä–æ—Å–º–æ—Ç—Ä—ã —ç–∫—Ä–∞–Ω–æ–≤ |
| **Events** | –°–æ–±—ã—Ç–∏—è |
| **Conversions** | –ö–æ–Ω–≤–µ—Ä—Å–∏–∏ |
| **Retention** | –£–¥–µ—Ä–∂–∞–Ω–∏–µ |
| **Revenue** | –í—ã—Ä—É—á–∫–∞ |

### AppMetrica / Amplitude

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| **DAU/WAU/MAU** | –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ |
| **Retention** | –£–¥–µ—Ä–∂–∞–Ω–∏–µ (Day 1, Day 7, Day 30) |
| **Stickiness** | –ü—Ä–∏–ª–∏–ø—á–∏–≤–æ—Å—Ç—å (DAU/MAU) |
| **Session Length** | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏ |
| **Sessions per User** | –°–µ—Å—Å–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| **Revenue** | –í—ã—Ä—É—á–∫–∞ |
| **LTV** | Lifetime Value |
| **Cohort Analysis** | –ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ |

---

## –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å

1. **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö** ‚Äî azg_admin –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–µ—Å—å –æ–±—ä–µ–∫—Ç –∫–∞–∫ –º–µ—Ç—Ä–∏–∫–∏)
2. **–¢–∏–ø—ã –º–µ—Ç—Ä–∏–∫** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–∞–∫ `product` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Å—Å–∏–≤–æ–≤** ‚Äî `top_events` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ `event_*`

### ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

1. **–î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É** ‚Äî –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥** ‚Äî –≤–º–µ—Å—Ç–æ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
3. **–î–æ–±–∞–≤–∏—Ç—å DAU/WAU/MAU** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –æ–±–µ—Ä—Ç–∫—É `metrics` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–°–æ–∑–¥–∞—Ç—å endpoint `/api/v1/metrics`** –¥–ª—è azg_admin:
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥ (day/week/month)
   - –í–∫–ª—é—á–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É
   - –§–æ—Ä–º–∞—Ç: `{"timestamp": "...", "metrics": {...}}`

2. **–û—Å—Ç–∞–≤–∏—Ç—å `/api/v1/stats/summary`** –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - –í–∫–ª—é—á–∞–µ—Ç `top_events` –∫–∞–∫ –º–∞—Å—Å–∏–≤

3. **–î–æ–±–∞–≤–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ DAU/WAU/MAU** –≤ –æ–±–∞ endpoint'–∞

---

## –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–°–º. —Ñ–∞–π–ª `backend/app/routes/metrics.py` (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–Ω) –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ `stats.py`:

```python
@router.get("/metrics")
async def get_metrics_for_monitoring(
    period: str = Query("day", regex="^(day|week|month)$"),
    db: AsyncSession = Depends(get_db)
) -> dict:
    """
    –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (azg_admin)

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º —Å azg_admin
    """
    now = datetime.now(timezone.utc)

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–∏–æ–¥
    if period == "day":
        start_date = now.replace(hour=0, minute=0, second=0, microsecond=0)
    elif period == "week":
        start_date = now - timedelta(days=7)
    elif period == "month":
        start_date = now - timedelta(days=30)

    # –í—ã—á–∏—Å–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
    metrics = await calculate_metrics_for_period(db, start_date, now)

    return {
        "timestamp": now.isoformat(),
        "metrics": metrics
    }
```

---

## –ß–µ–∫-–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- [ ] –°–æ–∑–¥–∞—Ç—å endpoint `/api/v1/metrics` –¥–ª—è azg_admin
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ DAU/WAU/MAU
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥ –≤–º–µ—Å—Ç–æ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã—Ö
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É –≤ –æ—Ç–≤–µ—Ç
- [ ] –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å `top_events` –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å azg_admin –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ endpoint'–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤ azg_admin

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [API_STATS_SUMMARY.md](./API_STATS_SUMMARY.md) ‚Äî –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ endpoint'–∞
- [ANALYTICS.md](./ANALYTICS.md) ‚Äî –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- [azg_admin MONITORING_GUIDE.md](../../azg_admin/docs/MONITORING_GUIDE.md) ‚Äî –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É


