# Конфигурация Caddy для Convertik API
# Добавьте этот блок в существующий Caddyfile на сервере

convertik.ponravilos.ru {
    # Автоматическое получение SSL сертификата от Let's Encrypt
    
    # Логирование
    log {
        output file /var/log/caddy/convertik.log
        format json
    }
    
    # Проксирование на Convertik API контейнер
    reverse_proxy convertik-api:8000 {
        # Настройки для FastAPI
        header_up Host {host}
        header_up X-Real-IP {remote}
        header_up X-Forwarded-For {remote}
        header_up X-Forwarded-Proto {scheme}
        
        # Timeout настройки
        transport http {
            read_timeout 30s
            write_timeout 30s
        }
    }
    
    # Дополнительные заголовки безопасности
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
    }
    
    # CORS для API (если нужно)
    @api path /api/*
    handle @api {
        header Access-Control-Allow-Origin *
        header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        header Access-Control-Allow-Headers "Content-Type, Authorization"
        reverse_proxy convertik-api:8000
    }
}