#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –≤–∞–ª—é—Ç
"""

import subprocess
import time
import os

def run_command(command):
    """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã"""
    try:
        result = subprocess.run(command, shell=True, capture_output=True, text=True)
        return result.returncode == 0, result.stdout, result.stderr
    except Exception as e:
        return False, "", str(e)

def test_sorting_feature():
    """–¢–µ—Å—Ç –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏"""
    device_id = "iPhone 16 Pro"
    
    print("üéØ –¢–ï–°–¢ –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–ò –°–û–†–¢–ò–†–û–í–ö–ò –í–ê–õ–Æ–¢")
    print("=" * 50)
    
    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
    test_dir = "sorting_test_screenshots"
    os.makedirs(test_dir, exist_ok=True)
    
    time.sleep(3)  # –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    
    # 1. –ë–∞–∑–æ–≤—ã–π —Å–∫—Ä–∏–Ω—à–æ—Ç (–¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å RUB –ø–µ—Ä–≤–æ–π)
    print("1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è...")
    run_command(f'xcrun simctl io "{device_id}" screenshot {test_dir}/01_main_rub_first.png')
    print("   ‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ —Å–æ–∑–¥–∞–Ω")
    
    # 2. –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–∫–Ω–æ–ø–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏)
    print("2. –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...")
    sort_button_x, sort_button_y = 960, 120  # –ö–Ω–æ–ø–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (—Å—Ç—Ä–µ–ª–æ—á–∫–∏)
    run_command(f'xcrun simctl io "{device_id}" tap {sort_button_x} {sort_button_y}')
    time.sleep(2)
    
    run_command(f'xcrun simctl io "{device_id}" screenshot {test_dir}/02_edit_mode_active.png')
    print("   ‚úÖ –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω")
    
    # 3. –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –ø–æ—è–≤–∏–ª—Å—è –±–∞–Ω–Ω–µ—Ä —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ RUB
    print("3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –±–∞–Ω–Ω–µ—Ä–∞...")
    time.sleep(1)
    run_command(f'xcrun simctl io "{device_id}" screenshot {test_dir}/03_rub_info_banner.png')
    print("   ‚úÖ –ë–∞–Ω–Ω–µ—Ä —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ RUB –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–µ–Ω")
    
    # 4. –ü–æ–ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤–∞–ª—é—Ç—É (–Ω–µ RUB)
    print("4. –¢–µ—Å—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤–∞–ª—é—Ç...")
    # –ü–æ–ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤—Ç–æ—Ä—É—é –≤–∞–ª—é—Ç—É
    currency_area_x, currency_area_y = 400, 350  # –û–±–ª–∞—Å—Ç—å –≤—Ç–æ—Ä–æ–π –≤–∞–ª—é—Ç—ã
    run_command(f'xcrun simctl io "{device_id}" tap {currency_area_x} {currency_area_y}')
    time.sleep(1)
    
    # –ü–æ–ø—Ä–æ–±—É–µ–º drag gesture (—Å–∏–º—É–ª–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ)
    run_command(f'xcrun simctl io "{device_id}" screenshot {test_dir}/04_currency_interaction.png')
    print("   ‚úÖ –ü–æ–ø—ã—Ç–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –≤–∞–ª—é—Ç–∞–º–∏")
    
    # 5. –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    print("5. –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...")
    run_command(f'xcrun simctl io "{device_id}" tap {sort_button_x} {sort_button_y}')
    time.sleep(2)
    
    run_command(f'xcrun simctl io "{device_id}" screenshot {test_dir}/05_edit_mode_disabled.png')
    print("   ‚úÖ –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω")
    
    # 6. –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ RUB –≤—Å–µ –µ—â–µ –ø–µ—Ä–≤–∞—è
    print("6. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ RUB...")
    run_command(f'xcrun simctl io "{device_id}" screenshot {test_dir}/06_final_rub_check.png')
    print("   ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
    
    # 7. –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∞–ª—é—Ç—ã
    print("7. –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∞–ª—é—Ç—ã...")
    add_button_x, add_button_y = 1020, 120  # –ö–Ω–æ–ø–∫–∞ +
    run_command(f'xcrun simctl io "{device_id}" tap {add_button_x} {add_button_y}')
    time.sleep(3)
    
    run_command(f'xcrun simctl io "{device_id}" screenshot {test_dir}/07_add_currency_screen.png')
    print("   ‚úÖ –≠–∫—Ä–∞–Ω –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∞–ª—é—Ç—ã –æ—Ç–∫—Ä—ã—Ç")
    
    # –í–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥
    run_command(f'xcrun simctl io "{device_id}" tap 50 120')
    time.sleep(2)
    
    print("\n" + "=" * 50)
    print("üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –°–û–†–¢–ò–†–û–í–ö–ò")
    print("=" * 50)
    
    features_tested = [
        "‚úÖ –ë–∞–∑–æ–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å RUB –ø–µ—Ä–≤–æ–π",
        "‚úÖ –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è", 
        "‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–∞–Ω–Ω–µ—Ä –æ RUB",
        "‚úÖ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–∞–ª—é—Ç–∞–º–∏",
        "‚úÖ –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",
        "‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ RUB",
        "‚úÖ –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∞–ª—é—Ç—ã"
    ]
    
    for feature in features_tested:
        print(f"   {feature}")
    
    print(f"\n–í—Å–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ: {len(features_tested)}")
    print(f"–°–∫—Ä–∏–Ω—à–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤: {test_dir}/")
    
    print("\nüéâ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!")
    print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:")
    print("- RUB –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–µ—Ä–≤–æ–π –≤–∞–ª—é—Ç–æ–π")
    print("- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å")
    print("- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–∞–Ω–Ω–µ—Ä")
    print("- –í–∞–ª—é—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è")

if __name__ == "__main__":
    test_sorting_feature()